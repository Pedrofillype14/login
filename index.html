<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - ADD</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #eef3f7;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .login-card {
            width: 380px;
            padding: 30px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 0 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

<div class="login-card">
    <h3 class="text-center mb-4">üîê Login ADD</h3>

    <label class="form-label">Matr√≠cula:</label>
    <input type="text" id="matricula" class="form-control mb-3" placeholder="Digite sua matr√≠cula">

    <label class="form-label">Senha:</label>
    <input type="password" id="senha" class="form-control mb-4" placeholder="Digite sua senha">

    <button class="btn btn-primary w-100" onclick="logar()">Entrar</button>

    <p class="text-center text-danger mt-3" id="erro"></p>
</div>

<script>
async function logar() {
    const matricula = document.getElementById("matricula").value.trim();
    const senha = document.getElementById("senha").value.trim();
    const erro = document.getElementById("erro");

    if (!matricula || !senha) {
        erro.innerText = "‚ùå Preencha matr√≠cula e senha!";
        return;
    }

    try {
        const resp = await fetch("https://long-hall-0aaa.pedro-fillype.workers.dev/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ matricula, senha })
        });

        const data = await resp.json();

        if (!data.ok) {
            erro.innerText = "‚ùå Matr√≠cula ou senha incorreta!";
            return;
        }

        // Salva matr√≠cula logada
        localStorage.setItem("usuarioLogado", matricula);
        if (json.ok) {
            // SALVAR A MATR√çCULA ANTES DE MUDAR DE P√ÅGINA
            localStorage.setItem("matricula", matriculaDigitada); // <--- ADICIONE ISSO
            localStorage.setItem("usuarioLogado", "sim");         // <--- ADICIONE ISSO
        
            window.location.href = "https://pedrofillype14.github.io/prestacao_de_contas/"; // ou a url do form
        }
        // Redireciona para p√°gina de consulta
        window.location.href = "https://pedrofillype14.github.io/prestacao_de_contas/";

    } catch (err) {
        erroMsg.textContent = "ERRO (catch): " + err;
        erroMsg.style.display = "block";
    }
}
</script>

</body>
</html>
